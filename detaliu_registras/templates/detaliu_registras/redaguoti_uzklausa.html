{% extends "base.html" %}
{% block title %}Redaguoti užklausą{% endblock %}

{% block content %}
<div class="container">
  <h1 style="margin:16px 0">Redaguoti užklausą #{{ object.pk }}</h1>

  <form method="post" enctype="multipart/form-data" style="display:block">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="flash flash-error">{{ form.non_field_errors }}</div>
    {% endif %}

    <!-- UŽKLAUSA -->
    <section class="box">
      <h3 style="margin:0 0 10px">Užklausa</h3>
      <div class="grid">
        {% for field in form %}
          {% if field.name != "drawing_files" and field.name != "drawing_name" and field.name != "drawing_version" and field.name != "drawing_type" and field.name != "drawing_url" %}
            <label style="display:flex;flex-direction:column;gap:6px">
              <span>{{ field.label }}</span>
              {{ field }}
              {% if field.errors %}<span class="flash flash-error">{{ field.errors|join:", " }}</span>{% endif %}
            </label>
          {% endif %}
        {% endfor %}
      </div>
    </section>

    <!-- BRĖŽINIAI -->
    <section class="box">
      <h3 style="margin:0 0 10px">Pridėti brėžinius</h3>
      <div class="grid">
        <label style="display:flex;flex-direction:column;gap:6px">
          <span>Failai (galima keli)</span>
          {{ form.drawing_files }}
          {% if form.drawing_files.errors %}<span class="flash flash-error">{{ form.drawing_files.errors|join:", " }}</span>{% endif %}
        </label>
        <label style="display:flex;flex-direction:column;gap:6px">
          <span>Pavadinimas</span>
          {{ form.drawing_name }}
        </label>
        <label style="display:flex;flex-direction:column;gap:6px">
          <span>Versija</span>
          {{ form.drawing_version }}
        </label>
        <label style="display:flex;flex-direction:column;gap:6px">
          <span>Tipas (neprivaloma)</span>
          {{ form.drawing_type }}
        </label>
        <label style="display:flex;flex-direction:column;gap:6px">
          <span>Išorinis URL</span>
          {{ form.drawing_url }}
        </label>
      </div>
      <div style="color:#6b7280;font-size:.9em;margin-top:8px">
        Leidžiami: JPG, JPEG, PNG, BMP, WEBP, GIF, SVG, PDF, DXF, DWG.
      </div>

      {% if object.detale and object.detale.breziniai.all %}
        <div style="margin-top:12px;color:#6b7280">Jau pridėti brėžiniai:</div>
        <ul style="list-style:none;padding:0;margin:6px 0;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px">
          {% for b in object.detale.breziniai.all %}
            <li class="box" style="margin:0">
              <div style="font-weight:600">{{ b.pavadinimas|default:"Brėžinys" }}</div>
              {% if b.failas %}
                <a class="btn btn-secondary" href="{{ b.failas.url }}" target="_blank" rel="noopener">Atverti</a>
              {% elif b.isorinis_url %}
                <a class="btn btn-secondary" href="{{ b.isorinis_url }}" target="_blank" rel="noopener">Atverti (URL)</a>
              {% endif %}
              {% if b.versija %}<div style="color:#6b7280;margin-top:6px">Versija: {{ b.versija }}</div>{% endif %}
              <div style="color:#6b7280;margin-top:6px">Tipas: {{ b.tipas|upper }}</div>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </section>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
      <a class="btn btn-secondary" href="{% url 'detaliu_registras:perziureti_uzklausa' object.pk %}">Atšaukti</a>
      <button class="btn" type="submit">Išsaugoti</button>
    </div>
  </form>
</div>
{% endblock %}
