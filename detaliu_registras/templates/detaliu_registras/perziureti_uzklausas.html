{% extends "base.html" %}
{% load static %}

{% block title %}Užklausos{% endblock %}

{% block content %}
<div class="uzklausos-page">

  {% include "snippets/messages.html" %}

  <!-- Antraštė -->
  <header class="list-header">
    <h1>Užklausos</h1>
    <a class="btn btn-primary" href="{% url 'detaliu_registras:ivesti_uzklausa' %}">+ Nauja užklausa</a>
  </header>

  <!-- Filtrai -->
  <section class="filters-wrap">
    <form method="get" class="filters-form">
      <div class="filters-grid">
        <label class="f">
          <span>Paieška</span>
          {{ filter_form.q }}
        </label>
        <label class="f">
          <span>Klientas</span>
          {{ filter_form.klientas }}
        </label>
        <label class="f">
          <span>Projektas</span>
          {{ filter_form.projektas }}
        </label>
        <label class="f">
          <span>Brėžinio nr.</span>
          {{ filter_form.brezinio_nr }}
        </label>
        <label class="f">
          <span>Metalas</span>
          {{ filter_form.metalas }}
        </label>
        <label class="f">
          <span>Padengimas</span>
          {{ filter_form.padengimas }}
        </label>
      </div>
      <div class="filters-actions">
        <button class="btn" type="submit">Filtruoti</button>
        <a class="btn btn-secondary" href="{% url 'detaliu_registras:uzklausa_list' %}">Išvalyti</a>
      </div>
    </form>
  </section>

  <!-- Lentelė -->
  <section class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Klientas</th>
          <th>Projektas</th>
          <th>Detalė</th>
          <th>Brėžinio nr.</th>
          <th>Metalas</th>
          <th>Sukurta</th>
          <th class="text-right">Veiksmai</th>
        </tr>
      </thead>
      <tbody>
        {% for u in uzklausos %}
          <tr>
            <td><a href="{% url 'detaliu_registras:perziureti_uzklausa' u.pk %}">#{{ u.pk }}</a></td>
            <td>{{ u.klientas|default:"—" }}</td>
            <td>{{ u.projektas|default:"—" }}</td>
            <td>{{ u.detale.pavadinimas|default:"—" }}</td>
            <td class="mono">{{ u.detale.brezinio_nr|default:"—" }}</td>
            <td>{% if u.detale.specifikacija %}{{ u.detale.specifikacija.metalas|default:"—" }}{% else %}—{% endif %}</td>
            <td>{{ u.data|date:"Y-m-d" }}</td>
            <td class="text-right">
              <a class="btn btn-sm" href="{% url 'detaliu_registras:perziureti_uzklausa' u.pk %}">Peržiūrėti</a>
              <a class="btn btn-sm btn-secondary" href="{% url 'detaliu_registras:redaguoti_uzklausa' u.pk %}">Redaguoti</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="8" class="empty">Įrašų nėra.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- Puslapiavimas -->
  {% if is_paginated %}
    <nav class="pagination">
      {% if page_obj.has_previous %}
        <a class="page" href="?page={{ page_obj.previous_page_number }}{% if request.GET %}&{{ request.GET.urlencode|cut:'page='|cut:page_obj.number %}{% endif %}">‹</a>
      {% else %}<span class="page disabled">‹</span>{% endif %}

      <span class="page current">Puslapis {{ page_obj.number }} iš {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a class="page" href="?page={{ page_obj.next_page_number }}{% if request.GET %}&{{ request.GET.urlencode|cut:'page='|cut:page_obj.number %}{% endif %}">›</a>
      {% else %}<span class="page disabled">›</span>{% endif %}
    </nav>
  {% endif %}
</div>

<style>
/* ===== Izoliacija nuo base.html ===== */
.uzklausos-page {
  box-sizing: border-box;
  max-width: 1200px; margin: 0 auto; padding: 16px;
  display: block !important;        /* atšaukiam galimą grid/flex iš base */
}
.uzklausos-page * { box-sizing: border-box; }

/* ===== Antraštė ===== */
.list-header {
  display:flex; align-items:center; justify-content:space-between;
  gap: 12px; margin: 8px 0 12px;
}
.list-header h1 { margin: 0; }

/* ===== Mygtukai ===== */
.btn { padding:6px 10px; border:1px solid #d1d5db; border-radius:6px; background:#f9fafb; text-decoration:none; color:#111827; }
.btn-primary { background:#2563eb; color:#fff; border-color:#2563eb; }
.btn-secondary { background:#f3f4f6; color:#111827; }
.btn-sm { padding:4px 8px; font-size:.875rem; }

/* ===== Filtrai ===== */
.filters-wrap {
  background:#fff; border:1px solid #e5e7eb; border-radius:8px;
  padding:12px; margin-bottom:12px;
}
.filters-form { display:flex; flex-direction:column; gap:12px; }
.filters-grid { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:12px; }
.f { display:flex; flex-direction:column; gap:4px; }
.filters-actions { display:flex; gap:8px; justify-content:flex-end; }

/* ===== Lentelė (aiški ir ne „suspausta“) ===== */
.table-wrap { overflow-x:auto; }
.table { width:100%; border-collapse: collapse; table-layout: auto; }  /* jokio fixed */
.table th, .table td {
  padding:10px 8px; border-bottom:1px solid #e5e7eb;
  vertical-align: middle;
  white-space: normal;              /* leidžiam laužyti eilutes */
  word-break: break-word;           /* kad ilgi žodžiai nesugriautų pločio */
}
.table thead th { background:#fff; position:static; } /* be sticky */
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }

/* stulpelių minimalūs pločiai aiškumui */
.table th:nth-child(1), .table td:nth-child(1) { width: 72px; white-space:nowrap; }
.table th:nth-child(8), .table td:nth-child(8) { width: 150px; white-space:nowrap; }

/* veiksmai */
.text-right { text-align:right; }
.text-right .btn { display:inline-block; margin-left:6px; }

/* tuščia būsena */
.empty { color:#6b7280; font-style:italic; text-align:center; padding:8px; }

/* puslapiavimas */
.pagination { display:flex; gap:8px; align-items:center; justify-content:flex-end; margin: 12px 0 18px; }
.page { padding:4px 8px; border:1px solid #d1d5db; border-radius:6px; }
.page.current { background:#f3f4f6; }
.page.disabled { opacity:.5; pointer-events:none; }

/* responsive */
@media (max-width: 900px) {
  .filters-grid { grid-template-columns: 1fr; }
}
</style>
{% endblock %}
