{% extends "base.html" %}
{% block title %}{% if obj %}Redaguoti kainą{% else %}Nauja kaina{% endif %}{% endblock %}

{% block content %}
<h1 style="margin:0 0 8px">{% if obj %}Redaguoti kainą{% else %}Nauja kaina{% endif %} – {{ pozicija.poz_kodas }}</h1>
<p><a class="btn btn-secondary" href="{% url 'pozicijos:kainos_list' pozicija.pk %}">← Atgal į kainas</a></p>

<form method="post" class="box" style="max-width:720px">
  {% csrf_token %}
  <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px">
    <label>Kaina {{ form.kaina }}</label>
    <label>Matas {{ form.matas }}</label>

    <label style="grid-column:1/-1">
      <span style="display:flex;gap:6px;align-items:center">
        {{ form.yra_fiksuota }} <span>Fiksuota</span>
      </span>
    </label>

    <label>Fiksuotas kiekis {{ form.fiksuotas_kiekis }}</label>
    <div></div>

    <label>Kiekis nuo {{ form.kiekis_nuo }}</label>
    <label>Kiekis iki {{ form.kiekis_iki }}</label>

    <label>Galioja nuo {{ form.galioja_nuo }}</label>
    <label>Galioja iki {{ form.galioja_iki }}</label>

    <label>Būsena {{ form.busena }}</label>
    <label>Prioritetas {{ form.prioritetas }}</label>

    <label style="grid-column:1/-1">Pastaba {{ form.pastaba }}</label>
  </div>

  {% if form.non_field_errors %}
    <div class="flash flash-error" style="margin-top:10px">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <div style="margin-top:12px;display:flex;gap:8px">
    <button class="btn" type="submit">Išsaugoti</button>
    <a class="btn btn-secondary" href="{% url 'pozicijos:kainos_list' pozicija.pk %}">Atšaukti</a>
  </div>
</form>

<script>
  // Paprastas UX: rodyti tinkamus laukus pagal "fiksuota"
  function toggleQtyFields(){
    const fx = document.getElementById('id_yra_fiksuota');
    const fxi = document.getElementById('id_fiksuotas_kiekis').closest('label');
    const nuo = document.getElementById('id_kiekis_nuo').closest('label');
    const iki = document.getElementById('id_kiekis_iki').closest('label');
    if (!fx || !fxi || !nuo || !iki) return;
    if (fx.checked){
      fxi.style.display = '';
      nuo.style.display = 'none';
      iki.style.display = 'none';
    } else {
      fxi.style.display = 'none';
      nuo.style.display = '';
      iki.style.display = '';
    }
  }
  document.addEventListener('change', e=>{
    if (e.target && e.target.id === 'id_yra_fiksuota'){ toggleQtyFields(); }
  });
  document.addEventListener('DOMContentLoaded', toggleQtyFields);
</script>
{% endblock %}
