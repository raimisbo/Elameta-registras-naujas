{% load static %}
<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8">
  <title>3D perÅ¾iÅ«ra â€“ {{ brezinys.pavadinimas|default:brezinys.filename }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  {# Online3DViewer website CSS â€“ iÅ¡ tavo bundle #}
  <link rel="stylesheet" type="text/css"
        href="{% static 'pozicijos/o3dv_website/o3dv.website.min.css' %}">

  <style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #111827;
  }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
                 "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    color: #e5e7eb;
  }
  .ov_header_title {
    font-size: 15px;
    font-weight: 600;
  }
  .ov_header_subtitle {
    font-size: 12px;
    opacity: .8;
  }
  .intro_content h1,
  .intro_content h2,
  .intro_content p,
  .intro_content ul {
    margin: 0 0 .6rem;
    padding: 0;
  }
  .intro_content ul {
    list-style: none;
    font-size: 13px;
    opacity: .9;
  }

  /* ðŸ”¹ Viewerâ€™Ä¯ iÅ¡tempiam be rÄ—meliÅ³, be â€žlangas langeâ€œ efekto */
  #main {
    display: flex;
    height: calc(100vh - 56px); /* jei header aukÅ¡tis kitas â€“ gali pakoreguot */
    margin: 0;
    padding: 0;
  }
  #main_viewer {
    flex: 1;
    min-width: 0;
    min-height: 0;
    width: 100%;
    height: 100%;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    box-shadow: none !important;
  }
  #main_viewer * {
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    box-shadow: none !important;
  }

  /* ðŸ”¹ Intro overlay nebedengia viewer'io */
  #intro {
    display: none;
  }
</style>


  {# ENGINE iÅ¡ tavo static: static/pozicijos/js/o3dv.min.js #}
  <script type="text/javascript"
          src="{% static 'pozicijos/js/o3dv.min.js' %}"></script>

  <script>
    // STEP failo URL iÅ¡ Django (tas pats, kurÄ¯ matai "Atidaryti" mygtuke)
    const STEP_MODEL_URL = "{{ brezinys.failas.url|escapejs }}";

    window.addEventListener('load', () => {
      if (!window.OV) {
        console.error('OV objektas nerastas â€“ nepasileido o3dv.min.js (patikrink static keliÄ…).');
        return;
      }

      const parent = document.getElementById('main_viewer');
      if (!parent) {
        console.error('Nerastas #main_viewer elementas 3D perÅ¾iÅ«rai.');
        return;
      }

      try {
        // Inicijuojam viewerâ€™Ä¯ embedded reÅ¾imu
        const viewer = new OV.EmbeddedViewer(parent, {
          backgroundColor : new OV.RGBAColor(17, 24, 39, 255),
          defaultColor    : new OV.RGBColor(200, 200, 200)
        });

        // UÅ¾kraunam STEP failÄ… iÅ¡ tavo Django
        viewer.LoadModelFromUrlList([STEP_MODEL_URL]);
      } catch (e) {
        console.error('Klaida inicijuojant 3D perÅ¾iÅ«rÄ…:', e);
      }
    });
  </script>
</head>

<body>
  {# Å ito nenaudojam tiesiogiai, bet to reikalauja Online3DViewer UI #}
  <input type="file" id="open_file" style="display:none;" multiple>

  <div class="header" id="header">
    <div class="title">
      <div class="title_left">
        <span class="logo_text">
          3D perÅ¾iÅ«ra
        </span>
        <span class="logo_separator">|</span>
        <span class="ov_header_title">
          {{ pozicija.poz_kodas }} â€“ {{ pozicija.poz_pavad }}
        </span>
        <span class="ov_header_subtitle only_full_width">
          {{ brezinys.pavadinimas|default:brezinys.filename }}
        </span>
      </div>
      <div class="title_right" id="header_buttons"></div>
      <div class="main_file_name only_full_width" id="main_file_name"></div>
    </div>
    <div class="toolbar" id="toolbar"></div>
  </div>

  <div class="main" id="main">
    <div class="main_left_container only_full_width" id="main_left_container">
      <div class="main_navigator ov_panel_set_container" id="main_navigator"></div>
      <div class="main_splitter" id="main_navigator_splitter"></div>
    </div>
    <div class="main_viewer" id="main_viewer"></div>
    <div class="main_right_container only_full_width" id="main_right_container">
      <div class="main_splitter" id="main_sidebar_splitter"></div>
      <div class="main_sidebar ov_panel_set_right_container" id="main_sidebar"></div>
    </div>
  </div>

  <div class="intro ov_thin_scrollbar" id="intro">
    <div class="intro_centered ov_common_form ov_thin_scrollbar" id="intro_center">
      <div class="intro_logo"></div>
      <div class="intro_content" id="intro_content">
        <h1>3D modelio Ä¯kÄ—limasâ€¦</h1>
        <p>Modelis: <strong>{{ brezinys.pavadinimas|default:brezinys.filename }}</strong></p>
        <ul>
          <li>â€¢ Sukimas: kairys pelÄ—s mygtukas + vilkimas.</li>
          <li>â€¢ Priartinimas / atitolinimas: pelÄ—s ratukas.</li>
          <li>â€¢ Pan: vidurinis / deÅ¡inys pelÄ—s mygtukas.</li>
          <li>â€¢ Matavimai: naudok matavimo Ä¯rankÄ¯ virÅ¡utinÄ—je juostoje.</li>
        </ul>
      </div>
    </div>
  </div>
</body>
</html>
