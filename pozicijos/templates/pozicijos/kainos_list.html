{% extends "base.html" %}
{% block title %}Kainos – {{ pozicija.poz_kodas }}{% endblock %}

{% block content %}
<h1 style="margin:0 0 8px">Kainos – {{ pozicija.poz_kodas }} <small style="color:#64748b">/ {{ pozicija.poz_pavad }}</small></h1>
<p style="margin:0 0 10px">
  <a class="btn" href="{% url 'pozicijos:kaina_create' pozicija.pk %}">+ Nauja kaina</a>
  <a class="btn btn-secondary" href="{% url 'pozicijos:detail' pozicija.pk %}">← Atgal į poziciją</a>
</p>

<form method="get" class="box" style="display:flex;gap:8px;flex-wrap:wrap;align-items:end">
  <label> Būsena
    <select name="busena">
      <option value="">– visos –</option>
      <option value="aktuali" {% if busena == 'aktuali' %}selected{% endif %}>Aktuali</option>
      <option value="sena" {% if busena == 'sena' %}selected{% endif %}>Sena</option>
      <option value="pasiulymas" {% if busena == 'pasiulymas' %}selected{% endif %}>Pasiūlymas</option>
    </select>
  </label>
  <label> Matas
    <select name="matas">
      <option value="">– visi –</option>
      <option value="vnt." {% if matas == 'vnt.' %}selected{% endif %}>vnt.</option>
      <option value="kg" {% if matas == 'kg' %}selected{% endif %}>kg</option>
      <option value="m2" {% if matas == 'm2' %}selected{% endif %}>m2</option>
    </select>
  </label>
  <button class="btn btn-secondary" type="submit">Filtruoti</button>
</form>

<div class="box" style="overflow:auto">
  <table class="table zebra" style="min-width:900px">
    <thead>
      <tr>
        <th>Suma</th><th>Matas</th><th>Tipas</th><th>Kiekis</th>
        <th>Galioja</th><th>Būsena</th><th>Prior.</th><th>Įrašyta</th><th>Veiksmai</th>
      </tr>
    </thead>
    <tbody>
      {% for k in kainos %}
        <tr>
          <td>{{ k.kaina }} €</td>
          <td>{{ k.matas }}</td>
          <td>{% if k.yra_fiksuota %}Fiksuota{% else %}Intervalas{% endif %}</td>
          <td>
            {% if k.yra_fiksuota %}
              {{ k.fiksuotas_kiekis }}
            {% else %}
              {{ k.kiekis_nuo|default:"–" }} – {{ k.kiekis_iki|default:"∞" }}
            {% endif %}
          </td>
          <td>{{ k.galioja_nuo|default:"–" }} – {{ k.galioja_iki|default:"∞" }}</td>
          <td>
            {% if k.busena == 'aktuali' %}
              <span style="background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;padding:2px 6px;border-radius:6px">Aktuali</span>
            {% elif k.busena == 'sena' %}
              <span style="background:#f3f4f6;border:1px solid #e5e7eb;color:#374151;padding:2px 6px;border-radius:6px">Sena</span>
            {% else %}
              <span style="background:#eff6ff;border:1px solid #bfdbfe;color:#1d4ed8;padding:2px 6px;border-radius:6px">Pasiūlymas</span>
            {% endif %}
          </td>
          <td>{{ k.prioritetas }}</td>
          <td>{{ k.created|date:"Y-m-d" }}</td>
          <td style="white-space:nowrap">
            <a class="btn btn-secondary" href="{% url 'pozicijos:kaina_update' k.id %}">Redaguoti</a>
            {% if k.busena != 'aktuali' %}
              <form action="{% url 'pozicijos:kaina_set_aktuali' k.id %}" method="post" style="display:inline">
                {% csrf_token %}
                <button class="btn" type="submit">Padaryti aktualia</button>
              </form>
            {% endif %}
            <a class="btn btn-secondary" href="{% url 'pozicijos:kaina_delete' k.id %}">Šalinti</a>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="9">Nėra įrašų.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
