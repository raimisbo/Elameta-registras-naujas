{% load attr %}

{% for it in items %}
<tr onclick="location.href='{% url 'pozicijos:detail' it.id %}'" style="cursor:pointer;">
  {% for c in columns_schema %}
    {% if c.key in visible_cols %}
      <td data-key="{{ c.key }}">
        {% if c.key == "maskavimo_tipas" %}
          {{ it.get_maskavimo_tipas_display|default:"—" }}

        {% elif c.key == "pakavimo_tipas" %}
          {{ it.get_pakavimo_tipas_display|default:"—" }}

        {% elif c.key == "atlikimo_terminas" %}
          {% if it.atlikimo_terminas is not None %}
            {{ it.atlikimo_terminas }} d.d.
          {% else %}
            —
          {% endif %}

        {% elif c.key == "brez_count" %}
          {{ it.brez_count|default:"0" }}

        {% elif c.key == "dok_count" %}
          {{ it.dok_count|default:"0" }}

        {% elif c.key == "matmenys_xyz" %}
          {{ it.matmenys_xyz|default:"—" }}

        {% elif c.key == "kaina_eur" %}
          {# Rėžis iš anotacijų: kaina_min/kaina_max (jei jų nėra – fallback į kaina_eur) #}
          {% if it.kaina_min is not None and it.kaina_max is not None %}
            {% if it.kaina_min == it.kaina_max %}
              {{ it.kaina_min|floatformat:4 }}
            {% else %}
              {{ it.kaina_min|floatformat:4 }}–{{ it.kaina_max|floatformat:4 }}
            {% endif %}
          {% elif it.kaina_eur is not None %}
            {{ it.kaina_eur|floatformat:4 }}
          {% else %}
            —
          {% endif %}

        {% else %}
          {{ it|attr:c.key|default:"—" }}
        {% endif %}
      </td>
    {% endif %}
  {% endfor %}
</tr>
{% empty %}
<tr><td colspan="{{ visible_cols|length }}">Nėra įrašų.</td></tr>
{% endfor %}
