{# pozicijos/templates/pozicijos/kaina_history.html #}
{% extends "base.html" %}

{% block title %}Kainos istorija – {{ kaina.id }}{% endblock %}
{% block body_class %}kainos-history-page{% endblock %}

{% block page_css %}
<style>
  .kainos-history-page { background:#f3f3f3; }
  .history-container { max-width:1200px; margin:0 auto; padding:16px 20px 32px; }

  .history-header {
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    margin-bottom:12px;
    flex-wrap:wrap;
  }
  .history-title { margin:0; font-size:1.35rem; font-weight:700; }
  .history-sub { margin:4px 0 0; color:#6b7280; font-size:0.92rem; }

  .btn{
    border:1px solid #d1d5db;
    background:#fff;
    padding:7px 12px;
    border-radius:8px;
    cursor:pointer;
    text-decoration:none;
    color:#111827;
    font-size:0.9rem;
    display:inline-flex;
    align-items:center;
    gap:6px;
  }
  .btn:hover{ filter:brightness(0.98); }

  .card{
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:10px;
    padding:12px 14px;
    box-shadow:0 1px 0 rgba(0,0,0,0.03);
  }

  table { width:100%; border-collapse:collapse; }
  th, td { border:1px solid #e5e7eb; padding:6px 8px; font-size:0.92rem; vertical-align:top; }
  th { background:#f9fafb; text-align:left; font-weight:700; }

  .type { font-weight:700; }
  .type-plus { color:#15803d; }
  .type-tilde { color:#b45309; }
  .type-minus { color:#b91c1c; }

  .muted { color:#6b7280; }
</style>
{% endblock %}

{% block content %}
<div class="history-container">

  <div class="history-header">
    <div>
      <h1 class="history-title">Kainos istorija – #{{ kaina.id }}</h1>
      <div class="history-sub">
        Pozicija: {{ pozicija.poz_kodas|default:pozicija.id }}{% if pozicija.poz_pavad %} — {{ pozicija.poz_pavad }}{% endif %}
      </div>
    </div>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn" href="{% url 'pozicijos:kainos_list' pozicija.pk %}">← Atgal į kainas</a>
      <a class="btn" href="{% url 'pozicijos:detail' pozicija.pk %}">← Atgal į poziciją</a>
    </div>
  </div>

  <div class="card">
    {% if history %}
      <table>
        <thead>
          <tr>
            <th style="width:180px;">Data</th>
            <th style="width:90px;">Tipas</th>
            <th style="width:160px;">Vartotojas</th>
            <th>Kaina</th>
            <th>Matas</th>
            <th>Kiekis nuo</th>
            <th>Kiekis iki</th>
            <th>Būsena</th>
            <th>Galioja nuo</th>
            <th>Galioja iki</th>
            <th>Pastaba</th>
          </tr>
        </thead>
        <tbody>
          {% for h in history %}
            <tr>
              <td>
                {% if h.history_date %}{{ h.history_date|date:"Y-m-d H:i" }}{% else %}—{% endif %}
              </td>
              <td class="type">
                {% if h.history_type == "+" %}
                  <span class="type-plus">+</span>
                {% elif h.history_type == "~" %}
                  <span class="type-tilde">~</span>
                {% elif h.history_type == "-" %}
                  <span class="type-minus">-</span>
                {% else %}
                  {{ h.history_type|default:"—" }}
                {% endif %}
              </td>
              <td class="muted">
                {% if h.history_user %}
                  {{ h.history_user }}
                {% else %}
                  —
                {% endif %}
              </td>

              <td>{% if h.kaina is None %}—{% else %}{{ h.kaina }}{% endif %}</td>
              <td>{{ h.matas|default:"" }}</td>
              <td>{% if h.kiekis_nuo is None %}—{% else %}{{ h.kiekis_nuo }}{% endif %}</td>
              <td>{% if h.kiekis_iki is None %}—{% else %}{{ h.kiekis_iki }}{% endif %}</td>
              <td>{{ h.busena|default:"—" }}</td>
              <td>{% if h.galioja_nuo %}{{ h.galioja_nuo|date:"Y-m-d" }}{% else %}—{% endif %}</td>
              <td>{% if h.galioja_iki %}{{ h.galioja_iki|date:"Y-m-d" }}{% else %}—{% endif %}</td>
              <td>{{ h.pastaba|default:"" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="muted">Istorijos įrašų nėra.</div>
    {% endif %}
  </div>

</div>
{% endblock %}
