{# pozicijos/templates/pozicijos/form.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}
  {% if pozicija %}Redaguoti poziciją{% else %}Nauja pozicija{% endif %}
{% endblock %}

{% block page_css %}
<style>
  .poz-form-wrapper{margin-top:8px;}
  .poz-form-header{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap;}
  .poz-form-header h1{margin:0;font-size:1.3rem;font-weight:600;}
  .poz-form-header .actions{display:flex;gap:6px;flex-wrap:wrap;}

  .poz-form{display:flex;flex-direction:column;gap:12px;}
  .poz-block{
    border:1px solid #e5e7eb;
    border-radius:8px;
    padding:10px 12px 12px;
    background:#fff;
  }
  .poz-block legend{
    padding:0 4px;
    font-size:.95rem;
    font-weight:600;
    color:#111827;
  }

  .poz-grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px 16px;}
  .poz-grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px 16px;}
  @media(max-width:900px){
    .poz-grid-2,.poz-grid-3{grid-template-columns:1fr;}
  }

  .poz-field-row{display:flex;flex-direction:column;gap:2px;}
  .poz-field-row label{font-size:.85rem;color:#374151;}
  .poz-field-row input,
  .poz-field-row textarea{
    width:100%;
    box-sizing:border-box;
    padding:6px 8px;
    border-radius:6px;
    border:1px solid #d1d5db;
    font-size:.9rem;
  }
  .poz-field-row input:focus,
  .poz-field-row textarea:focus{
    outline:2px solid #60a5fa;
    outline-offset:1px;
    border-color:#60a5fa;
  }

  .poz-form-footer{display:flex;justify-content:flex-end;gap:8px;margin-top:4px;}
</style>
{% endblock %}

{% block content %}
<div class="poz-form-wrapper">
  <div class="poz-form-header">
    <h1>
      {% if pozicija %}
        Redaguoti poziciją {{ pozicija.poz_kodas }} – {{ pozicija.poz_pavad }}
      {% else %}
        Nauja pozicija
      {% endif %}
    </h1>
    <div class="actions">
      <a href="{% url 'pozicijos:list' %}" class="btn btn-secondary">← Atgal į sąrašą</a>
      {% if pozicija %}
        <a href="{% url 'pozicijos:detail' pozicija.pk %}" class="btn btn-secondary">Pozicijos kortelė</a>
      {% endif %}
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" class="poz-form">
    {% csrf_token %}

    {# Pagrindinė informacija #}
    <fieldset class="poz-block">
      <legend>Pagrindinė informacija</legend>
      <div class="poz-grid-2">
        <div class="poz-field-row">
          {{ form.klientas.label_tag }}
          {{ form.klientas }}
        </div>
        <div class="poz-field-row">
          {{ form.projektas.label_tag }}
          {{ form.projektas }}
        </div>
        <div class="poz-field-row">
          {{ form.poz_kodas.label_tag }}
          {{ form.poz_kodas }}
        </div>
        <div class="poz-field-row">
          {{ form.poz_pavad.label_tag }}
          {{ form.poz_pavad }}
        </div>
      </div>
    </fieldset>

    {# Specifikacija #}
    <fieldset class="poz-block">
      <legend>Specifikacija</legend>
      <div class="poz-grid-3">
        <div class="poz-field-row">
          {{ form.metalas.label_tag }}
          {{ form.metalas }}
        </div>
        <div class="poz-field-row">
          {{ form.plotas.label_tag }}
          {{ form.plotas }}
        </div>
        <div class="poz-field-row">
          {{ form.svoris.label_tag }}
          {{ form.svoris }}
        </div>
      </div>
    </fieldset>

    {# Kabinimas #}
    <fieldset class="poz-block">
      <legend>Kabinimas</legend>
      <div class="poz-grid-2">
        <div class="poz-field-row">
          {{ form.kabinimo_budas.label_tag }}
          {{ form.kabinimo_budas }}
        </div>
        <div class="poz-field-row">
          {{ form.kabinimas_reme.label_tag }}
          {{ form.kabinimas_reme }}
        </div>
        <div class="poz-field-row">
          {{ form.detaliu_kiekis_reme.label_tag }}
          {{ form.detaliu_kiekis_reme }}
        </div>
        <div class="poz-field-row">
          {{ form.faktinis_kiekis_reme.label_tag }}
          {{ form.faktinis_kiekis_reme }}
        </div>
      </div>
    </fieldset>

    {# Paviršius / dažymas #}
    <fieldset class="poz-block">
      <legend>Paviršius / dažymas</legend>
      <div class="poz-grid-3">
        <div class="poz-field-row">
          {{ form.paruosimas.label_tag }}
          {{ form.paruosimas }}
        </div>
        <div class="poz-field-row">
          {{ form.padengimas.label_tag }}
          {{ form.padengimas }}
        </div>
        <div class="poz-field-row">
          {{ form.padengimo_standartas.label_tag }}
          {{ form.padengimo_standartas }}
        </div>
        <div class="poz-field-row">
          {{ form.spalva.label_tag }}
          {{ form.spalva }}
        </div>
        <div class="poz-field-row">
          {{ form.maskavimas.label_tag }}
          {{ form.maskavimas }}
        </div>
        <div class="poz-field-row">
          {{ form.testai_kokybe.label_tag }}
          {{ form.testai_kokybe }}
        </div>
      </div>
    </fieldset>

    {# Terminai #}
    <fieldset class="poz-block">
      <legend>Terminai</legend>
      <div class="poz-grid-2">
        <div class="poz-field-row">
          {{ form.atlikimo_terminas.label_tag }}
          {{ form.atlikimo_terminas }}
        </div>
      </div>
    </fieldset>

    {# Pakavimas #}
    <fieldset class="poz-block">
      <legend>Pakavimas</legend>
      <div class="poz-grid-3">
        <div class="poz-field-row">
          {{ form.pakavimas.label_tag }}
          {{ form.pakavimas }}
        </div>
        <div class="poz-field-row">
          {{ form.instrukcija.label_tag }}
          {{ form.instrukcija }}
        </div>
        <div class="poz-field-row">
          {{ form.pakavimo_dienos_norma.label_tag }}
          {{ form.pakavimo_dienos_norma }}
        </div>
        <div class="poz-field-row">
          {{ form.pak_po_ktl.label_tag }}
          {{ form.pak_po_ktl }}
        </div>
        <div class="poz-field-row">
          {{ form.pak_po_milt.label_tag }}
          {{ form.pak_po_milt }}
        </div>
      </div>
    </fieldset>

    {# Kaina #}
    <fieldset class="poz-block">
      <legend>Kaina</legend>
      <div class="poz-grid-2">
        <div class="poz-field-row">
          {{ form.kaina_eur.label_tag }}
          {{ form.kaina_eur }}
        </div>
      </div>
      <p class="muted" style="margin-top:4px;font-size:.8rem;">
        Įvesta kaina automatiškai sinchronizuojama su naująja „KainosEilute“ sistema (bazinis pasiūlymas „vnt.“).
      </p>
    </fieldset>

    {# Pastabos #}
    <fieldset class="poz-block">
      <legend>Pastabos</legend>
      <div class="poz-field-row">
        {{ form.pastabos.label_tag }}
        {{ form.pastabos }}
      </div>
    </fieldset>

    <div class="poz-form-footer">
      <a href="{% url 'pozicijos:list' %}" class="btn btn-secondary">Atšaukti</a>
      <button type="submit" class="btn">
        {% if pozicija %}Išsaugoti{% else %}Sukurti poziciją{% endif %}
      </button>
    </div>

    {# ---- DATALIST'ai iš suggestions (auto-suggest iš DB) ---- #}
    {% if suggestions %}
      <datalist id="dl-klientas">
        {% for v in suggestions.klientas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-projektas">
        {% for v in suggestions.projektas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-metas">
        {% comment %}jei nori, gali pervadinti į dl-metas, bet formoje list="dl-metas" tada keist reikėtų{% endcomment %}
      </datalist>
      <datalist id="dl-metalas">
        {% for v in suggestions.metalas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-kabinimo_budas">
        {% for v in suggestions.kabinimo_budas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-kabinimas_reme">
        {% for v in suggestions.kabinimas_reme %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-paruosimas">
        {% for v in suggestions.paruosimas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-padengimas">
        {% for v in suggestions.padengimas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-padengimo_standartas">
        {% for v in suggestions.padengimo_standartas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-spalva">
        {% for v in suggestions.spalva %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-maskavimas">
        {% for v in suggestions.maskavimas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-testai_kokybe">
        {% for v in suggestions.testai_kokybe %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-pakavimas">
        {% for v in suggestions.pakavimas %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
      <datalist id="dl-instrukcija">
        {% for v in suggestions.instrukcija %}
          <option value="{{ v }}"></option>
        {% endfor %}
      </datalist>
    {% endif %}

  </form>
</div>
{% endblock %}
