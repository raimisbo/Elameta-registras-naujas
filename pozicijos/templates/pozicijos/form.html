{# pozicijos/templates/pozicijos/form.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}
  {% if pozicija %}Redaguoti poziciją {{ pozicija.poz_kodas }}{% else %}Nauja pozicija{% endif %}
{% endblock %}

{% block page_css %}
<style>
  .poz-form-page { background:#f3f3f3; }
  .poz-form-container { max-width:1200px; margin:0 auto; padding:16px 20px 32px; }

  .poz-header { display:flex; align-items:flex-start; justify-content:space-between; gap:16px; margin-bottom:12px; }
  .poz-title { margin:0; font-size:1.35rem; font-weight:700; }
  .poz-subtitle{ margin-top:4px; color:#6b7280; font-size:0.9rem; }

  .poz-actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .btn{ border:1px solid #d1d5db; background:#fff; padding:7px 12px; border-radius:8px; cursor:pointer; text-decoration:none; color:#111827; font-size:0.9rem; }
  .btn-primary{ background:#111827; color:#fff; border-color:#111827; }
  .btn-secondary{ background:#fff; }
  .btn:hover{ filter:brightness(0.98); }

  .poz-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  @media (max-width: 980px){
    .poz-grid{ grid-template-columns:1fr; }
  }

  .poz-card{
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:10px;
    padding:12px 12px 10px;
    box-shadow:0 1px 0 rgba(0,0,0,0.03);
  }
  .poz-card--full{ grid-column:1 / -1; }
  .poz-card-title{
    margin:0 0 10px;
    font-size:1rem;
    font-weight:700;
    border-bottom:1px solid #f3f4f6;
    padding-bottom:6px;
  }

  .field-row{ display:grid; grid-template-columns: 220px 1fr; gap:10px; align-items:flex-start; margin:8px 0; }
  .field-label{ color:#374151; font-size:0.88rem; padding-top:6px; }
  .field-control input[type="text"],
  .field-control input[type="number"],
  .field-control input[type="date"],
  .field-control select,
  .field-control textarea{
    width:100%;
    border:1px solid #d1d5db;
    border-radius:8px;
    box-sizing:border-box;
    padding:4px 6px;
    font-size:0.9rem;
  }
  .field-control input[type="checkbox"]{ width:auto; padding:0; }

  .field-errors{ margin-top:2px; font-size:0.8rem; color:#b91c1c; }
  .field-help{ font-size:0.78rem; color:#9ca3af; margin-top:2px; }

  .inline-checkboxes{ display:flex; flex-wrap:wrap; gap:12px; margin:6px 0 4px; }
  .inline-checkboxes label{ display:inline-flex; align-items:center; gap:6px; white-space:nowrap; font-size:0.9rem; cursor:pointer; }

  .subblock{ margin-top:8px; padding:8px 10px; border:1px dashed #d1d5db; border-radius:6px; background:#fff; }

  textarea { resize: vertical; }
</style>
{% endblock %}

{% block content %}
<div class="poz-form-page">
  <div class="poz-form-container">

    <div class="poz-header">
      <div>
        <h1 class="poz-title">
          {% if pozicija %}Pozicija {{ pozicija.poz_kodas|default:pozicija.id }}{% else %}Nauja pozicija{% endif %}
        </h1>
        <div class="poz-subtitle">Redagavimo forma.</div>
      </div>

      <div class="poz-actions">
        <a class="btn btn-secondary" href="{% url 'pozicijos:list' %}">Grįžti</a>
      </div>
    </div>

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="poz-card" style="border-color:#fecaca;background:#fff1f2;">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <div class="poz-grid">

      <section class="poz-card">
        <h2 class="poz-card-title">Pagrindiniai</h2>

        <div class="field-row">
          <div class="field-label">{{ form.klientas.label }}</div>
          <div class="field-control">
            {{ form.klientas }}
            {% if form.klientas.errors %}<div class="field-errors">{{ form.klientas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.projektas.label }}</div>
          <div class="field-control">
            {{ form.projektas }}
            {% if form.projektas.errors %}<div class="field-errors">{{ form.projektas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.poz_kodas.label }}</div>
          <div class="field-control">
            {{ form.poz_kodas }}
            {% if form.poz_kodas.errors %}<div class="field-errors">{{ form.poz_kodas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.poz_pavad.label }}</div>
          <div class="field-control">
            {{ form.poz_pavad }}
            {% if form.poz_pavad.errors %}<div class="field-errors">{{ form.poz_pavad.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

      <section class="poz-card">
        <h2 class="poz-card-title">Detalė</h2>

        <div class="field-row">
          <div class="field-label">{{ form.metalas.label }}</div>
          <div class="field-control">
            {{ form.metalas }}
            {% if form.metalas.errors %}<div class="field-errors">{{ form.metalas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.plotas.label }}</div>
          <div class="field-control">
            {{ form.plotas }}
            {% if form.plotas.errors %}<div class="field-errors">{{ form.plotas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.svoris.label }}</div>
          <div class="field-control">
            {{ form.svoris }}
            {% if form.svoris.errors %}<div class="field-errors">{{ form.svoris.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        {# Matmenys XYZ (mm) - NAUJA #}
        <div class="field-row">
          <div class="field-label">{{ form.x_mm.label }}</div>
          <div class="field-control">
            {{ form.x_mm }}
            {% if form.x_mm.errors %}<div class="field-errors">{{ form.x_mm.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.y_mm.label }}</div>
          <div class="field-control">
            {{ form.y_mm }}
            {% if form.y_mm.errors %}<div class="field-errors">{{ form.y_mm.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.z_mm.label }}</div>
          <div class="field-control">
            {{ form.z_mm }}
            {% if form.z_mm.errors %}<div class="field-errors">{{ form.z_mm.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">Matmenys (xyz)</div>
          <div class="field-control">
            <div id="matmenys-xyz-preview" style="padding-top:6px;">
              {% if pozicija %}{{ pozicija.matmenys_xyz }}{% else %}—{% endif %}
            </div>
          </div>
        </div>
      </section>
      <section class="poz-card">
        <h2 class="poz-card-title">Kabinimas</h2>

        <div style="display:flex; justify-content:space-between; align-items:baseline; margin:2px 0 8px;">
          <div style="font-weight:700;">KTL</div>
          <div id="ktl-kabinimas-status" style="font-size:.9rem; color:#6b7280;">—</div>
        </div>

        <div id="ktl-kabinimas-subblock" style="display:none;">
          <div class="field-row">
            <div class="field-label">{{ form.ktl_kabinimo_budas.label }}</div>
            <div class="field-control">
              {{ form.ktl_kabinimo_budas }}
              {% if form.ktl_kabinimo_budas.errors %}<div class="field-errors">{{ form.ktl_kabinimo_budas.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_kabinimas_reme_txt.label }}</div>
            <div class="field-control">
              {{ form.ktl_kabinimas_reme_txt }}
              {% if form.ktl_kabinimas_reme_txt.errors %}<div class="field-errors">{{ form.ktl_kabinimas_reme_txt.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_detaliu_kiekis_reme.label }}</div>
            <div class="field-control">
              {{ form.ktl_detaliu_kiekis_reme }}
              {% if form.ktl_detaliu_kiekis_reme.errors %}<div class="field-errors">{{ form.ktl_detaliu_kiekis_reme.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_faktinis_kiekis_reme.label }}</div>
            <div class="field-control">
              {{ form.ktl_faktinis_kiekis_reme }}
              {% if form.ktl_faktinis_kiekis_reme.errors %}<div class="field-errors">{{ form.ktl_faktinis_kiekis_reme.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_ilgis_mm.label }}</div>
            <div class="field-control">
              {{ form.ktl_ilgis_mm }}
              {% if form.ktl_ilgis_mm.errors %}<div class="field-errors">{{ form.ktl_ilgis_mm.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_aukstis_mm.label }}</div>
            <div class="field-control">
              {{ form.ktl_aukstis_mm }}
              {% if form.ktl_aukstis_mm.errors %}<div class="field-errors">{{ form.ktl_aukstis_mm.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_gylis_mm.label }}</div>
            <div class="field-control">
              {{ form.ktl_gylis_mm }}
              {% if form.ktl_gylis_mm.errors %}<div class="field-errors">{{ form.ktl_gylis_mm.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">Matmenų sandauga</div>
            <div class="field-control">
              <div style="padding-top:6px; color:#6b7280;">
                {% if form.instance.ktl_matmenu_sandauga %}{{ form.instance.ktl_matmenu_sandauga|floatformat:1 }}{% else %}—{% endif %}
              </div>
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.ktl_kabinimas_aprasymas.label }}</div>
            <div class="field-control">
              {{ form.ktl_kabinimas_aprasymas }}
              {% if form.ktl_kabinimas_aprasymas.errors %}<div class="field-errors">{{ form.ktl_kabinimas_aprasymas.errors|striptags }}</div>{% endif %}
            </div>
          </div>
        </div>

        <hr style="border:0;border-top:1px solid #f3f4f6;margin:12px 0;">

        <div style="display:flex; justify-content:space-between; align-items:baseline; margin:2px 0 8px;">
          <div style="font-weight:700;">Miltai</div>
          <div id="miltai-kabinimas-status" style="font-size:.9rem; color:#6b7280;">—</div>
        </div>

        <div id="miltai-kabinimas-subblock" style="display:none;">
          <div class="field-row">
            <div class="field-label">{{ form.miltai_kiekis_per_valanda.label }}</div>
            <div class="field-control">
              {{ form.miltai_kiekis_per_valanda }}
              {% if form.miltai_kiekis_per_valanda.errors %}<div class="field-errors">{{ form.miltai_kiekis_per_valanda.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltai_detaliu_kiekis_reme.label }}</div>
            <div class="field-control">
              {{ form.miltai_detaliu_kiekis_reme }}
              {% if form.miltai_detaliu_kiekis_reme.errors %}<div class="field-errors">{{ form.miltai_detaliu_kiekis_reme.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltai_faktinis_kiekis_reme.label }}</div>
            <div class="field-control">
              {{ form.miltai_faktinis_kiekis_reme }}
              {% if form.miltai_faktinis_kiekis_reme.errors %}<div class="field-errors">{{ form.miltai_faktinis_kiekis_reme.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltai_kabinimas_aprasymas.label }}</div>
            <div class="field-control">
              {{ form.miltai_kabinimas_aprasymas }}
              {% if form.miltai_kabinimas_aprasymas.errors %}<div class="field-errors">{{ form.miltai_kabinimas_aprasymas.errors|striptags }}</div>{% endif %}
            </div>
          </div>
        </div>

        {% if form.instance.kabinimo_budas or form.instance.kabinimas_reme or form.instance.detaliu_kiekis_reme or form.instance.faktinis_kiekis_reme %}
          <hr style="border:0;border-top:1px solid #f3f4f6;margin:12px 0;">
          <details>
            <summary style="cursor:pointer; color:#6b7280;">Senas kabinimas (legacy)</summary>
            <div style="margin-top:10px;">
              <div class="field-row">
                <div class="field-label">{{ form.kabinimo_budas.label }}</div>
                <div class="field-control">
                  {{ form.kabinimo_budas }}
                  {% if form.kabinimo_budas.errors %}<div class="field-errors">{{ form.kabinimo_budas.errors|striptags }}</div>{% endif %}
                </div>
              </div>

              <div class="field-row">
                <div class="field-label">{{ form.kabinimas_reme.label }}</div>
                <div class="field-control">
                  {{ form.kabinimas_reme }}
                  {% if form.kabinimas_reme.errors %}<div class="field-errors">{{ form.kabinimas_reme.errors|striptags }}</div>{% endif %}
                </div>
              </div>

              <div class="field-row">
                <div class="field-label">{{ form.detaliu_kiekis_reme.label }}</div>
                <div class="field-control">
                  {{ form.detaliu_kiekis_reme }}
                  {% if form.detaliu_kiekis_reme.errors %}<div class="field-errors">{{ form.detaliu_kiekis_reme.errors|striptags }}</div>{% endif %}
                </div>
              </div>

              <div class="field-row">
                <div class="field-label">{{ form.faktinis_kiekis_reme.label }}</div>
                <div class="field-control">
                  {{ form.faktinis_kiekis_reme }}
                  {% if form.faktinis_kiekis_reme.errors %}<div class="field-errors">{{ form.faktinis_kiekis_reme.errors|striptags }}</div>{% endif %}
                </div>
              </div>
            </div>
          </details>
        {% endif %}
      </section>
      <section class="poz-card">
        <h2 class="poz-card-title">Paslauga</h2>

        <div class="inline-checkboxes">
          <label>{{ form.paslauga_ktl }} <span>{{ form.paslauga_ktl.label }}</span></label>
          <label>{{ form.paslauga_miltai }} <span>{{ form.paslauga_miltai.label }}</span></label>
          <label>{{ form.paslauga_paruosimas }} <span>{{ form.paslauga_paruosimas.label }}</span></label>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.paruosimas.label }}</div>
          <div class="field-control">
            {{ form.paruosimas }}
            {% if form.paruosimas.errors %}<div class="field-errors">{{ form.paruosimas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.padengimas.label }}</div>
          <div class="field-control">
            {{ form.padengimas }}
            {% if form.padengimas.errors %}<div class="field-errors">{{ form.padengimas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.padengimo_standartas.label }}</div>
          <div class="field-control">
            {{ form.padengimo_standartas }}
            {% if form.padengimo_standartas.errors %}<div class="field-errors">{{ form.padengimo_standartas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.padengimo_storis_um.label }}</div>
          <div class="field-control">
            {{ form.padengimo_storis_um }}
            {% if form.padengimo_storis_um.errors %}<div class="field-errors">{{ form.padengimo_storis_um.errors|striptags }}</div>{% endif %}
            <div class="field-help">µm (mikronai), pvz. 80, 60–120, >60, >=60</div>
          </div>
        </div>

        <div class="field-row" id="row-spalva-top">
          <div class="field-label">{{ form.spalva.label }}</div>
          <div class="field-control">
            {{ form.spalva }}
            {% if form.spalva.errors %}<div class="field-errors">{{ form.spalva.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div id="miltai-subblock" class="subblock" style="display:none;">
          <div class="field-row">
            <div class="field-label">{{ form.miltu_kodas.label }}</div>
            <div class="field-control">
              {{ form.miltu_kodas }}
              {% if form.miltu_kodas.errors %}<div class="field-errors">{{ form.miltu_kodas.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltu_spalva.label }}</div>
            <div class="field-control">
              {{ form.miltu_spalva }}
              {% if form.miltu_spalva.errors %}<div class="field-errors">{{ form.miltu_spalva.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltu_tiekejas.label }}</div>
            <div class="field-control">
              {{ form.miltu_tiekejas }}
              {% if form.miltu_tiekejas.errors %}<div class="field-errors">{{ form.miltu_tiekejas.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltu_blizgumas.label }}</div>
            <div class="field-control">
              {{ form.miltu_blizgumas }}
              {% if form.miltu_blizgumas.errors %}<div class="field-errors">{{ form.miltu_blizgumas.errors|striptags }}</div>{% endif %}
            </div>
          </div>

          <div class="field-row">
            <div class="field-label">{{ form.miltu_kaina.label }}</div>
            <div class="field-control">
              {{ form.miltu_kaina }}
              {% if form.miltu_kaina.errors %}<div class="field-errors">{{ form.miltu_kaina.errors|striptags }}</div>{% endif %}
            </div>
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.paslaugu_pastabos.label }}</div>
          <div class="field-control">
            {{ form.paslaugu_pastabos }}
            {% if form.paslaugu_pastabos.errors %}<div class="field-errors">{{ form.paslaugu_pastabos.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

      <section class="poz-card">
        <h2 class="poz-card-title">Maskavimas</h2>

        <div class="field-row">
          <div class="field-label">{{ form.maskavimo_tipas.label }}</div>
          <div class="field-control" style="display:flex; gap:10px; align-items:center;">
            {{ form.maskavimo_tipas }}
            <button type="button" class="btn btn-secondary" id="maskavimas-add">Pridėti</button>
          </div>
        </div>

        {% if form.maskavimo_tipas.errors %}
          <div class="field-errors">{{ form.maskavimo_tipas.errors|striptags }}</div>
        {% endif %}

        {{ maskavimo_formset.management_form }}

        <div id="maskavimas-items" class="subblock" style="display:none;">
          {% for f in maskavimo_formset %}
            <div class="maskavimas-item" style="border-bottom:1px solid #f3f4f6; padding:8px 0;">
              {{ f.id }}
              <div style="display:none;">{{ f.DELETE }}</div>

              <div class="field-row">
                <div class="field-label">{{ f.maskuote.label }}</div>
                <div class="field-control">
                  {{ f.maskuote }}
                  {% if f.maskuote.errors %}<div class="field-errors">{{ f.maskuote.errors|striptags }}</div>{% endif %}
                </div>
              </div>

              <div class="field-row">
                <div class="field-label">{{ f.vietu_kiekis.label }}</div>
                <div class="field-control">
                  {{ f.vietu_kiekis }}
                  {% if f.vietu_kiekis.errors %}<div class="field-errors">{{ f.vietu_kiekis.errors|striptags }}</div>{% endif %}
                </div>
              </div>

              <div style="display:flex; justify-content:flex-end;">
                <button type="button" class="btn btn-secondary maskavimas-remove">Pašalinti</button>
              </div>
            </div>
          {% endfor %}
        </div>

        <template id="maskavimas-empty-form">
          <div class="maskavimas-item" style="border-bottom:1px solid #f3f4f6; padding:8px 0;">
            {{ maskavimo_formset.empty_form.id }}
            <div style="display:none;">{{ maskavimo_formset.empty_form.DELETE }}</div>

            <div class="field-row">
              <div class="field-label">{{ maskavimo_formset.empty_form.maskuote.label }}</div>
              <div class="field-control">
                {{ maskavimo_formset.empty_form.maskuote }}
              </div>
            </div>

            <div class="field-row">
              <div class="field-label">{{ maskavimo_formset.empty_form.vietu_kiekis.label }}</div>
              <div class="field-control">
                {{ maskavimo_formset.empty_form.vietu_kiekis }}
              </div>
            </div>

            <div style="display:flex; justify-content:flex-end;">
              <button type="button" class="btn btn-secondary maskavimas-remove">Pašalinti</button>
            </div>
          </div>
        </template>
      </section>

      <section class="poz-card">
        <h2 class="poz-card-title">Terminai</h2>
        <div class="field-row">
          <div class="field-label">{{ form.atlikimo_terminas.label }}</div>
          <div class="field-control">
            {{ form.atlikimo_terminas }}
            {% if form.atlikimo_terminas.errors %}<div class="field-errors">{{ form.atlikimo_terminas.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

      <section class="poz-card">
        <h2 class="poz-card-title">Testai / kokybė</h2>
        <div class="field-row">
          <div class="field-label">{{ form.testai_kokybe.label }}</div>
          <div class="field-control">
            {{ form.testai_kokybe }}
            {% if form.testai_kokybe.errors %}<div class="field-errors">{{ form.testai_kokybe.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

      <section class="poz-card">
        <h2 class="poz-card-title">Pakavimas</h2>

        <div class="field-row">
          <div class="field-label">{{ form.pakavimo_tipas.label }}</div>
          <div class="field-control">
            {{ form.pakavimo_tipas }}
            {% if form.pakavimo_tipas.errors %}<div class="field-errors">{{ form.pakavimo_tipas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.pakavimas.label }}</div>
          <div class="field-control">
            {{ form.pakavimas }}
            {% if form.pakavimas.errors %}<div class="field-errors">{{ form.pakavimas.errors|striptags }}</div>{% endif %}
          </div>
        </div>

        <div class="field-row">
          <div class="field-label">{{ form.instrukcija.label }}</div>
          <div class="field-control">
            {{ form.instrukcija }}
            {% if form.instrukcija.errors %}<div class="field-errors">{{ form.instrukcija.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

      <section class="poz-card">
        <h2 class="poz-card-title">Papildomos paslaugos</h2>

        <div class="field-row">
          <div class="field-label">{{ form.papildomos_paslaugos.label }}</div>
          <div class="field-control">
            {{ form.papildomos_paslaugos }}
            {% if form.papildomos_paslaugos.errors %}<div class="field-errors">{{ form.papildomos_paslaugos.errors|striptags }}</div>{% endif %}
            <div class="field-help">Pasirinkus „Yra“ – atsiras aprašymo laukas.</div>
          </div>
        </div>

        <div class="field-row" id="papildomos-paslaugos-aprasymas-row" style="display:none;">
          <div class="field-label">{{ form.papildomos_paslaugos_aprasymas.label }}</div>
          <div class="field-control">
            {{ form.papildomos_paslaugos_aprasymas }}
            {% if form.papildomos_paslaugos_aprasymas.errors %}<div class="field-errors">{{ form.papildomos_paslaugos_aprasymas.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

      <section class="poz-card poz-card--full">
        <h2 class="poz-card-title">Kainos</h2>
        <div class="field-help" id="kaina-eur-preview" style="margin:-6px 0 10px;">Pagrindinė kaina (preview): <strong>—</strong></div>
        {% if pozicija and pozicija.pk %}
          {% include "pozicijos/components/kainos_formset.html" with formset=kainos_formset show_history_links=1 %}
        {% else %}
          {% include "pozicijos/components/kainos_formset.html" with formset=kainos_formset %}
        {% endif %}
      </section>

      <section class="poz-card poz-card--full">
        <h2 class="poz-card-title">Pastabos</h2>
        <div class="field-row">
          <div class="field-label">{{ form.pastabos.label }}</div>
          <div class="field-control">
            {{ form.pastabos }}
            {% if form.pastabos.errors %}<div class="field-errors">{{ form.pastabos.errors|striptags }}</div>{% endif %}
          </div>
        </div>
      </section>

    </div>

    <div class="poz-actions" style="margin-top:12px;">
      <button type="submit" class="btn btn-primary">Išsaugoti</button>
    </div>

  </form>

</div>
</div>

{% block page_js %}
  <script src="{% static 'pozicijos/js/poz_form_engine.js' %}"></script>
{% endblock %}
{% endblock %}
