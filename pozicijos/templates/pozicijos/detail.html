{# pozicijos/templates/pozicijos/detail.html #}
{% extends "base.html" %}
{% load attr %}

{% block title %}Pozicija {{ pozicija.poz_kodas }}{% endblock %}

{% block content %}
<h1>Pozicija {{ pozicija.poz_kodas }} – {{ pozicija.poz_pavad }}</h1>

<div class="actions" style="margin-bottom:12px; display:flex; gap:6px; flex-wrap:wrap;">
  <a href="{% url 'pozicijos:edit' pozicija.pk %}" class="btn">Redaguoti poziciją</a>
  <a href="{% url 'pozicijos:proposal_prepare' pozicija.pk %}" class="btn btn-secondary">Parengti pasiūlymą</a>
  <a href="{% url 'pozicijos:pdf' pozicija.pk %}" class="btn btn-secondary">PDF (peržiūra)</a>
  <a href="{% url 'pozicijos:list' %}" class="btn btn-secondary">Atgal į sąrašą</a>
</div>

<table class="detail-table">
  <tbody>
    {# einam per VISĄ schema, bet nerodom virtualių stulpelių #}
    {% for col in columns_schema %}
      {% if col.type != "virtual" %}
        <tr>
          <th>{{ col.label }}</th>
          <td>{{ pozicija|attr:col.key|default:"—" }}</td>
        </tr>
      {% endif %}
    {% endfor %}
  </tbody>
</table>

<h2 style="margin-top:16px;">Brėžiniai</h2>
<div style="margin-bottom:8px;">
  <form action="{% url 'pozicijos:brezinys_upload' pozicija.pk %}"
        method="post"
        enctype="multipart/form-data"
        style="display:flex; gap:6px; align-items:center;">
    {% csrf_token %}
    <input type="file" name="failas" required>
    <input type="text" name="pavadinimas" placeholder="Pavadinimas">
    <button type="submit" class="btn btn-secondary">Įkelti</button>
  </form>
</div>

{% if pozicija.breziniai.all %}
  <ul>
    {% for br in pozicija.breziniai.all %}
      <li>
        <a href="{{ br.failas.url }}" target="_blank">
          {{ br.pavadinimas|default:br.failas.name }}
        </a>
        <a href="{% url 'pozicijos:brezinys_delete' pozicija.pk br.pk %}"
           style="color:#b91c1c; margin-left:6px;">
          šalinti
        </a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>Brėžinių nėra.</p>
{% endif %}

<style>
.detail-table{
  border-collapse:collapse;
  background:#fff;
  margin-top:6px;
  min-width:420px;
}
.detail-table th,
.detail-table td{
  border:1px solid #eee;
  padding:6px 8px;
  text-align:left;
  vertical-align:top;
}
.detail-table th{
  background:#f8f8f8;
  width:240px;
}
a.btn,
button.btn{
  display:inline-block;
  padding:6px 10px;
  border-radius:6px;
  background:#2563eb;
  color:#fff;
  text-decoration:none;
  border:1px solid #2563eb;
}
.btn-secondary{
  background:#f3f4f6;
  color:#0f172a;
  border-color:#d1d5db;
}
</style>
{% endblock %}
