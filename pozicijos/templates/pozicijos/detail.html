{% extends "base.html" %}

{% block title %}Pozicija {{ pozicija.poz_kodas }}{% endblock %}

{% block content %}
<h1>Pozicija {{ pozicija.poz_kodas }} – {{ pozicija.poz_pavad }}</h1>

<p>
  <a href="{% url 'pozicijos:edit' pozicija.pk %}" class="btn btn-primary">Redaguoti poziciją</a>
  <a href="{% url 'pozicijos:kainos' pozicija.pk %}" class="btn btn-secondary">Kainos</a>
  <a href="{% url 'pozicijos:list' %}" class="btn btn-secondary">Atgal į sąrašą</a>
</p>

<table class="detail-table">
  <tbody>
    <tr><th>Klientas</th><td>{{ pozicija.klientas }}</td></tr>
    <tr><th>Projektas</th><td>{{ pozicija.projektas }}</td></tr>
    <tr><th>Kodas</th><td>{{ pozicija.poz_kodas }}</td></tr>
    <tr><th>Pavadinimas</th><td>{{ pozicija.poz_pavad }}</td></tr>
    <tr><th>Metalas</th><td>{{ pozicija.metalas }}</td></tr>
    <tr><th>Padengimas</th><td>{{ pozicija.padengimas }}</td></tr>
    <tr><th>Spalva</th><td>{{ pozicija.spalva }}</td></tr>
    <tr><th>Dabartinė kaina</th><td>{{ pozicija.kaina_eur }}</td></tr>
    <tr><th>Pastabos</th><td>{{ pozicija.pastabos|linebreaksbr }}</td></tr>
  </tbody>
</table>

<h2 style="margin-top:1rem;">Brėžiniai</h2>

<form action="{% url 'pozicijos:brezinys_upload' pozicija.pk %}" method="post" enctype="multipart/form-data" style="margin-bottom:.75rem;">
  {% csrf_token %}
  {{ brezinys_form.pavadinimas }} {{ brezinys_form.failas }}
  <button type="submit" class="btn btn-primary">Įkelti</button>
</form>

{% if breziniai %}
  <div style="display:flex; gap:.75rem; flex-wrap:wrap;">
    {% for b in breziniai %}
      <div style="width:150px; border:1px solid #eee; border-radius:6px; overflow:hidden; background:#fff;">
        <div style="width:150px; height:120px; display:flex; align-items:center; justify-content:center; background:#f8fafc;">
          {% if b.is_image %}
            <a href="{{ b.failas.url }}" target="_blank" title="{{ b.pavadinimas }}">
              <img src="{{ b.failas.url }}" alt="{{ b.pavadinimas }}" style="max-width:150px; max-height:120px; display:block;">
            </a>
          {% else %}
            <a href="{{ b.failas.url }}" target="_blank">{{ b.failas.name|slice:"-20:" }}</a>
          {% endif %}
        </div>
        <div style="padding:4px 6px; display:flex; justify-content:space-between; align-items:center; gap:.5rem;">
          <span style="font-size:.7rem; word-break:break-word;">{{ b.pavadinimas|default:"(be pavadinimo)" }}</span>
          <form action="{% url 'pozicijos:brezinys_delete' pozicija.pk b.pk %}" method="post" style="margin:0;">
            {% csrf_token %}
            <button type="submit" style="border:0; background:none; color:#b91c1c; font-size:.7rem; cursor:pointer;">✖</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>Brėžinių nėra.</p>
{% endif %}

<h2 style="margin-top:1rem;">Paskutinės kainos</h2>
{% if kainos %}
  <table class="detail-table">
    <thead>
      <tr>
        <th>Data</th>
        <th>Suma</th>
        <th>Matas</th>
        <th>Būsena</th>
        <th>Kiekis nuo</th>
        <th>Kiekis iki</th>
      </tr>
    </thead>
    <tbody>
      {% for k in kainos %}
        <tr>
          <td>{{ k.created|date:"Y-m-d H:i" }}</td>
          <td>{{ k.suma }}</td>
          <td>{{ k.kainos_matas }}</td>
          <td>{{ k.busena }}</td>
          <td>{{ k.kiekis_nuo }}</td>
          <td>{{ k.kiekis_iki }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>Kainų dar nėra.</p>
{% endif %}

<style>
.detail-table{border-collapse:collapse;background:#fff;margin-bottom:.75rem;}
.detail-table th,.detail-table td{border:1px solid #eee;padding:6px 8px;text-align:left}
.detail-table th{background:#f8f8f8}
</style>
{% endblock %}
