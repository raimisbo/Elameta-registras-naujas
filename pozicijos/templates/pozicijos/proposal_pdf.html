{# pozicijos/templates/pozicijos/proposal_pdf.html #}
{% extends "base.html" %}

{% block title %}Pasiūlymas – {{ pozicija.poz_kodas }}{% endblock %}

{% block content %}

<div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap;">
  <div style="display:flex;gap:8px;flex-wrap:wrap;">
    {# ATGAL mygtukas į pasiūlymo paruošimą #}
    <a href="{% url 'pozicijos:proposal_prepare' pozicija.pk %}" class="btn btn-secondary">
      ← Atgal
    </a>
    <a href="{% url 'pozicijos:detail' pozicija.pk %}" class="btn btn-secondary">
      Pozicijos kortelė
    </a>
  </div>
  <div style="font-size:13px;color:#6b7280;">
    Peržiūra (HTML) – tai, ką maždaug matysite PDF'e
  </div>
</div>

<h1 style="margin:0 0 4px;">Pasiūlymas – {{ pozicija.poz_kodas }}</h1>
<p style="margin:0 0 12px;font-size:14px;">
  {% if pozicija.poz_pavad %}
    <strong>Detalė:</strong> {{ pozicija.poz_pavad }}<br>
  {% endif %}
  {% if pozicija.klientas %}
    <strong>Klientas:</strong> {{ pozicija.klientas }}<br>
  {% endif %}
  {% if pozicija.projektas %}
    <strong>Projektas:</strong> {{ pozicija.projektas }}<br>
  {% endif %}
</p>

<div class="box" style="margin-bottom:12px;">
  <h2 style="margin:0 0 6px;font-size:16px;">Pagrindinė informacija</h2>
  <table style="width:100%;border-collapse:collapse;font-size:13px;">
    <tbody>
    {% if field_rows %}
      {% for label, val in field_rows %}
        <tr>
          <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;width:35%;background:#f9fafb;">
            {{ label }}
          </th>
          <td style="padding:4px 6px;border-bottom:1px solid #e5e7eb;">
            {{ val }}
          </td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td style="padding:4px 6px;color:#6b7280;">Nėra duomenų.</td>
      </tr>
    {% endif %}
    </tbody>
  </table>
</div>

{% if show_prices and kainos %}
  <div class="box" style="margin-bottom:12px;">
    <h2 style="margin:0 0 6px;font-size:16px;">Kainos (aktualios eilutės)</h2>
    <table style="width:100%;border-collapse:collapse;font-size:12px;">
      <thead>
      <tr style="background:#f9fafb;">
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Kaina €</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Matas</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Tipas</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Kiekis nuo</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Kiekis iki</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Fiks. kiekis</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Galioja nuo</th>
        <th style="text-align:left;padding:4px 6px;border-bottom:1px solid #e5e7eb;">Galioja iki</th>
      </tr>
      </thead>
      <tbody>
      {% for k in kainos %}
        <tr>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">{{ k.kaina }}</td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">{{ k.matas }}</td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">
            {% if k.yra_fiksuota %}Fiksuota{% else %}Intervalinė{% endif %}
          </td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">{{ k.kiekis_nuo|default:"—" }}</td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">{{ k.kiekis_iki|default:"—" }}</td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">{{ k.fiksuotas_kiekis|default:"—" }}</td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">
            {% if k.galioja_nuo %}{{ k.galioja_nuo|date:"Y-m-d" }}{% else %}—{% endif %}
          </td>
          <td style="padding:4px 6px;border-bottom:1px solid #f3f4f6;">
            {% if k.galioja_iki %}{{ k.galioja_iki|date:"Y-m-d" }}{% else %}—{% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% elif show_prices %}
  <div class="box" style="margin-bottom:12px;">
    <h2 style="margin:0 0 6px;font-size:16px;">Kainos</h2>
    <p style="margin:0;color:#6b7280;">Aktyvių kainų eilučių šiai pozicijai nėra.</p>
  </div>
{% endif %}

{% if show_drawings %}
  <div class="box" style="margin-bottom:12px;">
    <h2 style="margin:0 0 6px;font-size:16px;">Brėžinių miniatiūros</h2>
    {% if brez %}
      <div style="display:flex;flex-wrap:wrap;gap:10px;">
        {% for b in brez %}
          <div style="width:160px;border:1px solid #e5e7eb;border-radius:6px;padding:6px;background:#f9fafb;">
            <div style="width:100%;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;overflow:hidden;background:#fff;border-radius:4px;margin-bottom:4px;">
              {% if b.thumb_url %}
                <img src="{{ b.thumb_url }}" alt="" style="max-width:100%;max-height:100%;display:block;">
              {% elif b.failas.url %}
                <img src="{{ b.failas.url }}" alt="" style="max-width:100%;max-height:100%;display:block;">
              {% else %}
                <span style="font-size:11px;color:#9ca3af;">Nėra peržiūros</span>
              {% endif %}
            </div>
            <div style="font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
              {{ b.pavadinimas|default:b.filename }}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="margin:0;color:#6b7280;">Brėžinių nėra.</p>
    {% endif %}
  </div>
{% endif %}

{% if notes %}
  <div class="box" style="margin-bottom:12px;">
    <h2 style="margin:0 0 6px;font-size:16px;">Pastabos / sąlygos</h2>
    <pre style="margin:0;font-family:inherit;white-space:pre-wrap;font-size:13px;">{{ notes }}</pre>
  </div>
{% endif %}

{% endblock %}
